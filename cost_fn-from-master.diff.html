<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Darwin frankenbook-pro.local 13.4.0 Darwin Kernel Version 13.4.0: Sun Aug 17 19:50:11 PDT 2014; root:xnu-2422.115.4~1/RELEASE_X86_64 x86_64 --> 
<!-- Using awk: /usr/local/bin/gawk: GNU Awk 4.1.1, API: 1.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 2.8.1 --> 
<!-- Using wdiff: /usr/local/bin/wdiff: wdiff (GNU wdiff) 1.2.2 --> 
<html> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: master.txt - cost_fn.txt</title> 
  <style type="text/css"> 
    body    { margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;master.txt&nbsp;</th><th> </th><th>&nbsp;cost_fn.txt&nbsp;</th><th></th></tr> 
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Mobile Ad hoc Networks Working Group                          C. Perkins</td><td> </td><td class="right">Mobile Ad hoc Networks Working Group                          C. Perkins</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Internet-Draft                                                 Futurewei</td><td> </td><td class="right">Internet-Draft                                                 Futurewei</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Intended status: Standards Track                              S. Ratliff</td><td> </td><td class="right">Intended status: Standards Track                              S. Ratliff</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">Expires: June 2<span class="delete">8</span>, 2015                                           Idirect</td><td> </td><td class="rblock">Expires: June 2<span class="insert">9</span>, 2015                                           Idirect</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                              J. Dowdell</td><td> </td><td class="right">                                                              J. Dowdell</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                Airbus Defence and Space</td><td> </td><td class="right">                                                Airbus Defence and Space</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                       December 2<span class="delete">5</span>, 2014</td><td> </td><td class="rblock">                                                       December 2<span class="insert">6</span>, 2014</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                Dynamic MANET On-demand (AODVv2) Routing</td><td> </td><td class="right">                Dynamic MANET On-demand (AODVv2) Routing</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       draft-ietf-manet-aodvv2-06</td><td> </td><td class="right">                       draft-ietf-manet-aodvv2-06</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Abstract</td><td> </td><td class="right">Abstract</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The revised Ad Hoc On-demand Distance Vector (AODVv2) routing</td><td> </td><td class="right">   The revised Ad Hoc On-demand Distance Vector (AODVv2) routing</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   protocol is intended for use by mobile routers in wireless, multihop</td><td> </td><td class="right">   protocol is intended for use by mobile routers in wireless, multihop</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   networks.  AODVv2 determines unicast routes among AODVv2 routers</td><td> </td><td class="right">   networks.  AODVv2 determines unicast routes among AODVv2 routers</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   within the network in an on-demand fashion, offering rapid</td><td> </td><td class="right">   within the network in an on-demand fashion, offering rapid</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> page 1, line 37</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> page 1, line 37</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Internet-Drafts are working documents of the Internet Engineering</td><td> </td><td class="right">   Internet-Drafts are working documents of the Internet Engineering</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Task Force (IETF).  Note that other groups may also distribute</td><td> </td><td class="right">   Task Force (IETF).  Note that other groups may also distribute</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   working documents as Internet-Drafts.  The list of current Internet-</td><td> </td><td class="right">   working documents as Internet-Drafts.  The list of current Internet-</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Drafts is at http://datatracker.ietf.org/drafts/current/.</td><td> </td><td class="right">   Drafts is at http://datatracker.ietf.org/drafts/current/.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Internet-Drafts are draft documents valid for a maximum of six months</td><td> </td><td class="right">   Internet-Drafts are draft documents valid for a maximum of six months</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   and may be updated, replaced, or obsoleted by other documents at any</td><td> </td><td class="right">   and may be updated, replaced, or obsoleted by other documents at any</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   time.  It is inappropriate to use Internet-Drafts as reference</td><td> </td><td class="right">   time.  It is inappropriate to use Internet-Drafts as reference</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   material or to cite them other than as "work in progress."</td><td> </td><td class="right">   material or to cite them other than as "work in progress."</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   This Internet-Draft will expire on June 2<span class="delete">8</span>, 2015.</td><td> </td><td class="rblock">   This Internet-Draft will expire on June 2<span class="insert">9</span>, 2015.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Copyright Notice</td><td> </td><td class="right">Copyright Notice</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Copyright (c) 2014 IETF Trust and the persons identified as the</td><td> </td><td class="right">   Copyright (c) 2014 IETF Trust and the persons identified as the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   document authors.  All rights reserved.</td><td> </td><td class="right">   document authors.  All rights reserved.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   This document is subject to BCP 78 and the IETF Trust's Legal</td><td> </td><td class="right">   This document is subject to BCP 78 and the IETF Trust's Legal</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Provisions Relating to IETF Documents</td><td> </td><td class="right">   Provisions Relating to IETF Documents</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   (http://trustee.ietf.org/license-info) in effect on the date of</td><td> </td><td class="right">   (http://trustee.ietf.org/license-info) in effect on the date of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   publication of this document.  Please review these documents</td><td> </td><td class="right">   publication of this document.  Please review these documents</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> page 2, line 21</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> page 2, line 21</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   2.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   5</td><td> </td><td class="right">   2.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   5</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   3.  Data Elements and Notational Conventions  . . . . . . . . . .   8</td><td> </td><td class="right">   3.  Data Elements and Notational Conventions  . . . . . . . . . .   8</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   4.  Applicability Statement . . . . . . . . . . . . . . . . . . .   8</td><td> </td><td class="right">   4.  Applicability Statement . . . . . . . . . . . . . . . . . . .   8</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   5.  AODVv2 Message Transmission . . . . . . . . . . . . . . . . .  10</td><td> </td><td class="right">   5.  AODVv2 Message Transmission . . . . . . . . . . . . . . . . .  10</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   6.  Data Structures . . . . . . . . . . . . . . . . . . . . . . .  10</td><td> </td><td class="right">   6.  Data Structures . . . . . . . . . . . . . . . . . . . . . . .  10</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     6.1.  Route Table Entry . . . . . . . . . . . . . . . . . . . .  10</td><td> </td><td class="right">     6.1.  Route Table Entry . . . . . . . . . . . . . . . . . . . .  10</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     6.2.  Bidirectional Connectivity and Blacklists . . . . . . . .  12</td><td> </td><td class="right">     6.2.  Bidirectional Connectivity and Blacklists . . . . . . . .  12</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     6.3.  Router Clients and Client Networks  . . . . . . . . . . .  13</td><td> </td><td class="right">     6.3.  Router Clients and Client Networks  . . . . . . . . . . .  13</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     6.4.  Sequence Numbers  . . . . . . . . . . . . . . . . . . . .  13</td><td> </td><td class="right">     6.4.  Sequence Numbers  . . . . . . . . . . . . . . . . . . . .  13</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     6.5.  Metrics . . . . . . . . . . . . . . . . . . . . . . . . .  14</td><td> </td><td class="right">     6.5.  Metrics . . . . . . . . . . . . . . . . . . . . . . . . .  14</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">6.5.1.  The Cost() function . . . . . . . . . . . . . . . . .  15</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       6.5.2.  The LoopFree() function . . . . . . . . . . . . . . .  15</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       6.5.3.  Default Metric type . . . . . . . . . . . . . . . . .  15</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       6.5.4.  Alternate Metrics . . . . . . . . . . . . . . . . . .  16</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     6.6.  RREQ Table: Received RREQ Messages  . . . . . . . . . . .  16</td><td> </td><td class="right">     6.6.  RREQ Table: Received RREQ Messages  . . . . . . . . . . .  16</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   7.  AODVv2 Operations on Route Table Entries  . . . . . . . . . .  17</td><td> </td><td class="right">   7.  AODVv2 Operations on Route Table Entries  . . . . . . . . . .  17</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     7.1.  Evaluating Incoming Routing Information . . . . . . . . .  1<span class="delete">7</span></td><td> </td><td class="rblock">     7.1.  Evaluating Incoming Routing Information . . . . . . . . .  1<span class="insert">8</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     7.2.  Applying Route Updates To Route Table Entries . . . . . .  19</td><td> </td><td class="right">     7.2.  Applying Route Updates To Route Table Entries . . . . . .  19</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     7.3.  Route Table Entry Timeouts  . . . . . . . . . . . . . . .  <span class="delete">19</span></td><td> </td><td class="rblock">     7.3.  Route Table Entry Timeouts  . . . . . . . . . . . . . . .  <span class="insert">20</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   8.  Routing Messages RREQ and RREP (RteMsgs)  . . . . . . . . . .  20</td><td> </td><td class="right">   8.  Routing Messages RREQ and RREP (RteMsgs)  . . . . . . . . . .  20</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     8.1.  Route Discovery Retries and Buffering . . . . . . . . . .  2<span class="delete">0</span></td><td> </td><td class="rblock">     8.1.  Route Discovery Retries and Buffering . . . . . . . . . .  2<span class="insert">1</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     8.2.  RteMsg Structure  . . . . . . . . . . . . . . . . . . . .  21</td><td> </td><td class="right">     8.2.  RteMsg Structure  . . . . . . . . . . . . . . . . . . . .  21</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     8.3.  RREQ Generation . . . . . . . . . . . . . . . . . . . . .  2<span class="delete">2</span></td><td> </td><td class="rblock">     8.3.  RREQ Generation . . . . . . . . . . . . . . . . . . . . .  2<span class="insert">3</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     8.4.  RREP Generation . . . . . . . . . . . . . . . . . . . . .  23</td><td> </td><td class="right">     8.4.  RREP Generation . . . . . . . . . . . . . . . . . . . . .  23</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     8.5.  Handling a Received RteMsg  . . . . . . . . . . . . . . .  24</td><td> </td><td class="right">     8.5.  Handling a Received RteMsg  . . . . . . . . . . . . . . .  24</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       8.5.1.  Additional Handling for Incoming RREQ . . . . . . . .  25</td><td> </td><td class="right">       8.5.1.  Additional Handling for Incoming RREQ . . . . . . . .  25</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       8.5.2.  Additional Handling for Incoming RREP . . . . . . . .  26</td><td> </td><td class="right">       8.5.2.  Additional Handling for Incoming RREP . . . . . . . .  26</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     8.6.  Suppressing Redundant RREQ messages . . . . . . . . . . .  26</td><td> </td><td class="right">     8.6.  Suppressing Redundant RREQ messages . . . . . . . . . . .  26</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   9.  Route Maintenance and RERR Messages . . . . . . . . . . . . .  2<span class="delete">6</span></td><td> </td><td class="rblock">   9.  Route Maintenance and RERR Messages . . . . . . . . . . . . .  2<span class="insert">7</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     9.1.  Maintaining Route Lifetimes During Packet Forwarding  . .  27</td><td> </td><td class="right">     9.1.  Maintaining Route Lifetimes During Packet Forwarding  . .  27</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     9.2.  Next-hop Router Adjacency Monitoring  . . . . . . . . . .  27</td><td> </td><td class="right">     9.2.  Next-hop Router Adjacency Monitoring  . . . . . . . . . .  27</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     9.3.  RERR Generation . . . . . . . . . . . . . . . . . . . . .  28</td><td> </td><td class="right">     9.3.  RERR Generation . . . . . . . . . . . . . . . . . . . . .  28</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       9.3.1.  Case 1: Undeliverable Packet  . . . . . . . . . . . .  29</td><td> </td><td class="right">       9.3.1.  Case 1: Undeliverable Packet  . . . . . . . . . . . .  29</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       9.3.2.  Case 2: Broken Link . . . . . . . . . . . . . . . . .  <span class="delete">29</span></td><td> </td><td class="rblock">       9.3.2.  Case 2: Broken Link . . . . . . . . . . . . . . . . .  <span class="insert">30</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     9.4.  Receiving and Handling RERR Messages  . . . . . . . . . .  30</td><td> </td><td class="right">     9.4.  Receiving and Handling RERR Messages  . . . . . . . . . .  30</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   10. Representing AODVv2 data elements using RFC 5444  . . . . . .  31</td><td> </td><td class="right">   10. Representing AODVv2 data elements using RFC 5444  . . . . . .  31</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   11. Simple Internet Attachment  . . . . . . . . . . . . . . . . .  33</td><td> </td><td class="right">   11. Simple Internet Attachment  . . . . . . . . . . . . . . . . .  33</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   12. Multiple Interfaces . . . . . . . . . . . . . . . . . . . . .  34</td><td> </td><td class="right">   12. Multiple Interfaces . . . . . . . . . . . . . . . . . . . . .  34</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   13. AODVv2 Control Message Generation Limits  . . . . . . . . . .  <span class="delete">34</span></td><td> </td><td class="rblock">   13. AODVv2 Control Message Generation Limits  . . . . . . . . . .  <span class="insert">35</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   14. Optional Features . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">34</span></td><td> </td><td class="rblock">   14. Optional Features . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">35</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     14.1.  Expanding Rings Multicast  . . . . . . . . . . . . . . .  <span class="delete">34</span></td><td> </td><td class="rblock">     14.1.  Expanding Rings Multicast  . . . . . . . . . . . . . . .  <span class="insert">35</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     14.2.  Intermediate RREP  . . . . . . . . . . . . . . . . . . .  35</td><td> </td><td class="right">     14.2.  Intermediate RREP  . . . . . . . . . . . . . . . . . . .  35</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     14.3.  Precursor Lists and Notifications  . . . . . . . . . . .  35</td><td> </td><td class="right">     14.3.  Precursor Lists and Notifications  . . . . . . . . . . .  35</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       14.3.1.  Overview . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">35</span></td><td> </td><td class="rblock">       14.3.1.  Overview . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">36</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       14.3.2.  Precursor Notification Details . . . . . . . . . . .  <span class="delete">35</span></td><td> </td><td class="rblock">       14.3.2.  Precursor Notification Details . . . . . . . . . . .  <span class="insert">36</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock">     14.4.  Multicast RREP Response to RREQ  . . . . . . . . . . . .  <span class="insert">37</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     14.4.  Multicast RREP Response to RREQ  . . . . . . . . . . . .  <span class="delete">36</span></td><td> </td><td class="rblock">     14.5.  RREP_ACK . . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">37</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     14.5.  RREP_ACK . . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">36</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     14.6.  Message Aggregation  . . . . . . . . . . . . . . . . . .  37</td><td> </td><td class="right">     14.6.  Message Aggregation  . . . . . . . . . . . . . . . . . .  37</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   15. Administratively Configurable Parameters and Timer Values . .  <span class="delete">37</span></td><td> </td><td class="rblock">   15. Administratively Configurable Parameters and Timer Values . .  <span class="insert">38</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     15.1.  Timers . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">37</span></td><td> </td><td class="rblock">     15.1.  Timers . . . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">38</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     15.2.  Protocol constants . . . . . . . . . . . . . . . . . . .  <span class="delete">38</span></td><td> </td><td class="rblock">     15.2.  Protocol constants . . . . . . . . . . . . . . . . . . .  <span class="insert">39</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     15.3.  Administrative (functional) controls . . . . . . . . . .  <span class="delete">38</span></td><td> </td><td class="rblock">     15.3.  Administrative (functional) controls . . . . . . . . . .  <span class="insert">39</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     15.4.  Other administrative parameters and lists  . . . . . . .  39</td><td> </td><td class="right">     15.4.  Other administrative parameters and lists  . . . . . . .  39</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   16. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <span class="delete">39</span></td><td> </td><td class="rblock">   16. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <span class="insert">40</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     16.1.  AODVv2 Message Types Specification . . . . . . . . . . .  <span class="delete">39</span></td><td> </td><td class="rblock">     16.1.  AODVv2 Message Types Specification . . . . . . . . . . .  <span class="insert">40</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     16.2.  Message TLV Type Specification . . . . . . . . . . . . .  <span class="delete">39</span></td><td> </td><td class="rblock">     16.2.  Message TLV Type Specification . . . . . . . . . . . . .  <span class="insert">40</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     16.3.  Address Block TLV Specification  . . . . . . . . . . . .  <span class="delete">40</span></td><td> </td><td class="rblock">     16.3.  Address Block TLV Specification  . . . . . . . . . . . .  <span class="insert">41</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     16.4.  Metric Type Number Allocation  . . . . . . . . . . . . .  <span class="delete">40</span></td><td> </td><td class="rblock">     16.4.  Metric Type Number Allocation  . . . . . . . . . . . . .  <span class="insert">41</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   17. Security Considerations . . . . . . . . . . . . . . . . . . .  41</td><td> </td><td class="right">   17. Security Considerations . . . . . . . . . . . . . . . . . . .  41</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   18. Acknowledgments . . . . . . . . . . . . . . . . . . . . . . .  4<span class="delete">2</span></td><td> </td><td class="rblock">   18. Acknowledgments . . . . . . . . . . . . . . . . . . . . . . .  4<span class="insert">3</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   19. References  . . . . . . . . . . . . . . . . . . . . . . . . .  43</td><td> </td><td class="right">   19. References  . . . . . . . . . . . . . . . . . . . . . . . . .  43</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     19.1.  Normative References . . . . . . . . . . . . . . . . . .  43</td><td> </td><td class="right">     19.1.  Normative References . . . . . . . . . . . . . . . . . .  43</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     19.2.  Informative References . . . . . . . . . . . . . . . . .  <span class="delete">43</span></td><td> </td><td class="rblock">     19.2.  Informative References . . . . . . . . . . . . . . . . .  <span class="insert">44</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix A.  Example Algorithms for AODVv2 Protocol Operations  .  <span class="delete">44</span></td><td> </td><td class="rblock">   Appendix A.  Example Algorithms for AODVv2 Protocol Operations  .  <span class="insert">45</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.1.  Subroutines for AODVv2 Protocol Operations  . . . . . . .  <span class="delete">46</span></td><td> </td><td class="rblock">     A.1.  Subroutines for AODVv2 Protocol Operations  . . . . . . .  <span class="insert">47</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.2.  Example Algorithms for AODVv2 RREQ Operations . . . . . .  <span class="delete">47</span></td><td> </td><td class="rblock">     A.2.  Example Algorithms for AODVv2 RREQ Operations . . . . . .  <span class="insert">48</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.2.1.  Generate_RREQ . . . . . . . . . . . . . . . . . . . .  <span class="delete">47</span></td><td> </td><td class="rblock">       A.2.1.  Generate_RREQ . . . . . . . . . . . . . . . . . . . .  <span class="insert">48</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.2.2.  Receive_RREQ  . . . . . . . . . . . . . . . . . . . .  <span class="delete">48</span></td><td> </td><td class="rblock">       A.2.2.  Receive_RREQ  . . . . . . . . . . . . . . . . . . . .  <span class="insert">49</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.2.3.  Regenerate_RREQ . . . . . . . . . . . . . . . . . . .  <span class="delete">49</span></td><td> </td><td class="rblock">       A.2.3.  Regenerate_RREQ . . . . . . . . . . . . . . . . . . .  <span class="insert">50</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.3.  Example Algorithms for AODVv2 RREP Operations . . . . . .  <span class="delete">50</span></td><td> </td><td class="rblock">     A.3.  Example Algorithms for AODVv2 RREP Operations . . . . . .  <span class="insert">51</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.3.1.  Generate_RREP . . . . . . . . . . . . . . . . . . . .  <span class="delete">51</span></td><td> </td><td class="rblock">       A.3.1.  Generate_RREP . . . . . . . . . . . . . . . . . . . .  <span class="insert">52</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.3.2.  Receive_RREP  . . . . . . . . . . . . . . . . . . . .  <span class="delete">52</span></td><td> </td><td class="rblock">       A.3.2.  Receive_RREP  . . . . . . . . . . . . . . . . . . . .  <span class="insert">53</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.3.3.  Regenerate_RREP . . . . . . . . . . . . . . . . . . .  <span class="delete">53</span></td><td> </td><td class="rblock">       A.3.3.  Regenerate_RREP . . . . . . . . . . . . . . . . . . .  <span class="insert">54</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.3.4.  Consume_RREP  . . . . . . . . . . . . . . . . . . . .  <span class="delete">54</span></td><td> </td><td class="rblock">       A.3.4.  Consume_RREP  . . . . . . . . . . . . . . . . . . . .  <span class="insert">55</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.4.  Example Algorithms for AODVv2 RERR Operations . . . . . .  <span class="delete">54</span></td><td> </td><td class="rblock">     A.4.  Example Algorithms for AODVv2 RERR Operations . . . . . .  <span class="insert">55</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.4.1.  Generate_RERR . . . . . . . . . . . . . . . . . . . .  <span class="delete">54</span></td><td> </td><td class="rblock">       A.4.1.  Generate_RERR . . . . . . . . . . . . . . . . . . . .  <span class="insert">55</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.4.2.  Receive_RERR  . . . . . . . . . . . . . . . . . . . .  <span class="delete">55</span></td><td> </td><td class="rblock">       A.4.2.  Receive_RERR  . . . . . . . . . . . . . . . . . . . .  <span class="insert">56</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.4.3.  Regenerate_RERR . . . . . . . . . . . . . . . . . . .  <span class="delete">56</span></td><td> </td><td class="rblock">       A.4.3.  Regenerate_RERR . . . . . . . . . . . . . . . . . . .  <span class="insert">57</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     A.5.  Example Algorithms for AODVv2 RREP-Ack Operations . . . .  <span class="delete">58</span></td><td> </td><td class="rblock">     A.5.  Example Algorithms for AODVv2 RREP-Ack Operations . . . .  <span class="insert">59</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.5.1.  Generate_RREP_Ack . . . . . . . . . . . . . . . . . .  <span class="delete">58</span></td><td> </td><td class="rblock">       A.5.1.  Generate_RREP_Ack . . . . . . . . . . . . . . . . . .  <span class="insert">59</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.5.2.  Consume_RREP_Ack  . . . . . . . . . . . . . . . . . .  <span class="delete">58</span></td><td> </td><td class="rblock">       A.5.2.  Consume_RREP_Ack  . . . . . . . . . . . . . . . . . .  <span class="insert">59</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       A.5.3.  Timeout_RREP_Ack  . . . . . . . . . . . . . . . . . .  <span class="delete">58</span></td><td> </td><td class="rblock">       A.5.3.  Timeout_RREP_Ack  . . . . . . . . . . . . . . . . . .  <span class="insert">59</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix B.  Example RFC 5444-compliant packet formats  . . . . .  <span class="delete">58</span></td><td> </td><td class="rblock">   Appendix B.  Example RFC 5444-compliant packet formats  . . . . .  <span class="insert">59</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     B.1.  RREQ Message Format . . . . . . . . . . . . . . . . . . .  <span class="delete">59</span></td><td> </td><td class="rblock">     B.1.  RREQ Message Format . . . . . . . . . . . . . . . . . . .  <span class="insert">60</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     B.2.  RREP Message Format . . . . . . . . . . . . . . . . . . .  <span class="delete">61</span></td><td> </td><td class="rblock">     B.2.  RREP Message Format . . . . . . . . . . . . . . . . . . .  <span class="insert">62</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     B.3.  RERR Message Format . . . . . . . . . . . . . . . . . . .  <span class="delete">63</span></td><td> </td><td class="rblock">     B.3.  RERR Message Format . . . . . . . . . . . . . . . . . . .  <span class="insert">64</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     B.4.  RREP_ACK Message Format . . . . . . . . . . . . . . . . .  <span class="delete">64</span></td><td> </td><td class="rblock">     B.4.  RREP_ACK Message Format . . . . . . . . . . . . . . . . .  <span class="insert">65</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix C.  Changes since revision ...-04.txt  . . . . . . . . .  <span class="delete">64</span></td><td> </td><td class="rblock">   Appendix C.  Changes since revision ...-04.txt  . . . . . . . . .  <span class="insert">65</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix D.  Changes since revision ...-03.txt  . . . . . . . . .  <span class="delete">65</span></td><td> </td><td class="rblock">   Appendix D.  Changes since revision ...-03.txt  . . . . . . . . .  <span class="insert">66</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix E.  Changes since revision ...-02.txt  . . . . . . . . .  <span class="delete">65</span></td><td> </td><td class="rblock">   Appendix E.  Changes since revision ...-02.txt  . . . . . . . . .  <span class="insert">66</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Appendix F.  Multi-homing Considerations  . . . . . . . . . . . .  <span class="delete">66</span></td><td> </td><td class="rblock">   Appendix F.  Multi-homing Considerations  . . . . . . . . . . . .  <span class="insert">67</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Appendix G.  Shifting Network Prefix Advertisement Between AODVv2</td><td> </td><td class="right">   Appendix G.  Shifting Network Prefix Advertisement Between AODVv2</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                Routers  . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">66</span></td><td> </td><td class="rblock">                Routers  . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">67</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                         </td><td> </td><td class="rblock">   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <span class="insert">67</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <span class="delete">66</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">1.  Overview</td><td> </td><td class="right">1.  Overview</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The revised Ad Hoc On-demand Distance Vector (AODVv2) routing</td><td> </td><td class="right">   The revised Ad Hoc On-demand Distance Vector (AODVv2) routing</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   protocol [formerly named DYMO] enables on-demand, multihop unicast</td><td> </td><td class="right">   protocol [formerly named DYMO] enables on-demand, multihop unicast</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   routing among AODVv2 routers in mobile ad hod networks</td><td> </td><td class="right">   routing among AODVv2 routers in mobile ad hod networks</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   [MANETs][RFC2501].  The basic operations of the AODVv2 protocol are</td><td> </td><td class="right">   [MANETs][RFC2501].  The basic operations of the AODVv2 protocol are</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   route discovery and route maintenance.  Route discovery is performed</td><td> </td><td class="right">   route discovery and route maintenance.  Route discovery is performed</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   when an AODVv2 router must transmit a packet towards a destination</td><td> </td><td class="right">   when an AODVv2 router must transmit a packet towards a destination</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   for which it does not have a route.  Route maintenance is performed</td><td> </td><td class="right">   for which it does not have a route.  Route maintenance is performed</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> page 14, line 33</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> page 14, line 33</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   AODVv2 router SHOULD perform normal route table entry updates, but</td><td> </td><td class="right">   AODVv2 router SHOULD perform normal route table entry updates, but</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   not forward the message to other nodes.  If a data packet is received</td><td> </td><td class="right">   not forward the message to other nodes.  If a data packet is received</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   for forwarding to another destination during this waiting period, the</td><td> </td><td class="right">   for forwarding to another destination during this waiting period, the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   AODVv2 router MUST transmit a RERR message indicating that no route</td><td> </td><td class="right">   AODVv2 router MUST transmit a RERR message indicating that no route</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   is available.  At the end of the waiting period the AODVv2 router</td><td> </td><td class="right">   is available.  At the end of the waiting period the AODVv2 router</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   sets its SeqNum to one (1) and begins performing AODVv2 protocol</td><td> </td><td class="right">   sets its SeqNum to one (1) and begins performing AODVv2 protocol</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   operations again.</td><td> </td><td class="right">   operations again.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">6.5.  Metrics</td><td> </td><td class="right">6.5.  Metrics</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">AODVv2 route selection in MANETs depends upon associating metric</span></td><td> </td><td class="rblock">   <span class="insert">Metrics describe the quality of a</span> route <span class="insert">or a link.  They can take</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   information with each route table entry.  When presented with</span></td><td> </td><td class="rblock"><span class="insert">   various aspects into account, such as latency, delay, monetary,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   candidate</span> route <span class="delete">update information, deciding whether to use the</span></td><td> </td><td class="rblock"><span class="insert">   energy, etc.  Whenever an AODV router receives</span> metric information <span class="insert">in</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   update involves evaluating the metric.  Some applications may require</span></td><td> </td><td class="rblock"><span class="insert">   an incoming message, the value of</span> the metric is <span class="insert">as measured by the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   metric information <span class="delete">other than Hop Count, which has traditionally been</span></td><td> </td><td class="rblock"><span class="insert">   transmitting router, and does not reflect the cost</span> of <span class="insert">traversing</span> the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   the <span class="delete">default</span> metric <span class="delete">associated with routes in MANET.  It</span> is <span class="delete">well known</span></td><td> </td><td class="rblock">   <span class="insert">incoming link.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   that reliance on Hop Count can cause selection</span> of the <span class="delete">worst possible</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   route in many situations.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">It</span> is <span class="delete">beyond the scope of this document</span> to <span class="delete">describe how applications</span></td><td> </td><td class="rblock">   <span class="insert">Each routing table entry</span> is <span class="insert">associated with metric information.  When</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   specify route selection at</span> the <span class="delete">time they launch processing.  One</span></td><td> </td><td class="rblock"><span class="insert">   presented with information which may update a route, deciding whether</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   possibility would be to provide</span> a route metric <span class="delete">preference as part of</span></td><td> </td><td class="rblock">   to <span class="insert">use</span> the <span class="insert">information involves evaluating the metric.  For some</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   the library routines for opening sockets.  In view of</span> the <span class="delete">above</span></td><td> </td><td class="rblock"><span class="insert">   metrics,</span> a <span class="insert">maximum value is defined, namely MAX_METRIC[i]where 'i' is</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   considerations, it</span> is <span class="delete">important to enable route selection based on</span></td><td> </td><td class="rblock"><span class="insert">   the Metric Type.  AODVv2 does not store routes in its</span> route <span class="insert">table</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   metric <span class="delete">information other than Hop Count --</span> in <span class="delete">other words, based</span> on</td><td> </td><td class="rblock"><span class="insert">   that cost more than MAX_METRIC[i].</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">"alternate metrics".  Each such alternate</span> metric <span class="delete">measures</span> a <span class="delete">"cost"</span> of</td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">using</span> the <span class="delete">associated route, and there</span> are <span class="delete">many different kinds of</span></td><td> </td><td class="rblock"><span class="insert">   Each</span> metric <span class="insert">has to have a Metric Type, and</span> the <span class="insert">Metric Type</span> is</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   cost (latency, delay, monetary, energy, etc.).  The range and data</span></td><td> </td><td class="rblock">   <span class="insert">allocated by IANA as specified in [RFC6551].  Apart from its default</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   type of each such alternate</span> metric <span class="delete">may be different.  For instance,</span></td><td> </td><td class="rblock">   metric <span class="insert">type, which is detailed</span> in <span class="insert">Section 6.5.3, AODVv2 enables the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   the <span class="delete">data</span> type <span class="delete">might be integers, or floating point numbers, or</span></td><td> </td><td class="rblock"><span class="insert">   use of generic metrics, whose data type depends</span> on <span class="insert">the</span> metric <span class="insert">used.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   restricted subsets thereof.  Let "Cost(R)", where 'R' is the route</span></td><td> </td><td class="rblock"><span class="insert">   The Metric Type is specified by the [MetricType extension Type of the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   for which</span> the <span class="delete">Cost is</span> to <span class="delete">be evaluated;</span> the route <span class="delete">table entry for R</span></td><td> </td><td class="rblock"><span class="insert">   Metric TLV (Lottes version) | the MetricType TLV (current draft)] of</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   includes</span> the <span class="delete">information about</span> the <span class="delete">metric type</span> for <span class="delete">R.</span></td><td> </td><td class="rblock"><span class="insert">   each RteMsg.  As</span> a <span class="insert">natural result</span> of the <span class="insert">way routes</span> are <span class="insert">looked up</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   according to conformant</span> metric <span class="insert">type, all intermediate routers</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   handling a RteMsg will assign</span> the <span class="insert">same metric</span> type <span class="insert">to all metric</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   information in</span> the <span class="insert">RteMsg.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">6.5.1.  The Cost() function</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   In order</span> to <span class="insert">simplify</span> the <span class="insert">description of storing accumulated</span> route</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">costs in</span> the <span class="insert">route table, a Cost() function is defined.This function</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   returns</span> the <span class="insert">Cost of traversing a Route ('Cost(R)') or a Link</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   ('Cost(L)').  The specification of Cost(L)</span> for <span class="insert">metric types other</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   than DEFAULT_METRIC_TYPE is beyond the scope of this document.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">6.5.2.  The LoopFree() function</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Since determining loop freedom is known to depend on comparing the</td><td> </td><td class="right">   Since determining loop freedom is known to depend on comparing the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Cost(R) of route update information to the Cost(R) of an existing</td><td> </td><td class="right">   Cost(R) of route update information to the Cost(R) of an existing</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   stored route using the same metric, AODVv2 must also be able to</td><td> </td><td class="right">   stored route using the same metric, AODVv2 must also be able to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   invoke an abstract routine which in this document is called</td><td> </td><td class="right">   invoke an abstract routine which in this document is called</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   "LoopFree(R1, R2)".  LoopFree(R1, R2) returns TRUE when, (under the</td><td> </td><td class="right">   "LoopFree(R1, R2)".  LoopFree(R1, R2) returns TRUE when, (under the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   assumption of nondecreasing SeqNum during Route Discovery) given that</td><td> </td><td class="right">   assumption of nondecreasing SeqNum during Route Discovery) given that</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   R2 is loop-free and Cost(R2) is the cost of route R2, Cost(R1) is</td><td> </td><td class="right">   R2 is loop-free and Cost(R2) is the cost of route R2, Cost(R1) is</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   known to guarantee loop freedom of the route R1.  In this document,</td><td> </td><td class="right">   known to guarantee loop freedom of the route R1.  In this document,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   an AODVv2 router will only invoke LoopFree (AdvRte, Route), for</td><td> </td><td class="right">   an AODVv2 router will only invoke LoopFree (AdvRte, Route), for</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   routes AdvRte and Route which use the same metric to the same</td><td> </td><td class="right">   routes AdvRte and Route which use the same metric to the same</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   destination.  AdvRte is the route advertised in an incoming RREQ or</td><td> </td><td class="right">   destination.  AdvRte is the route advertised in an incoming RREQ or</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   RREP, and is used as parameter R1 for LoopFree.  Route is a route</td><td> </td><td class="right">   RREP, and is used as parameter R1 for LoopFree.  Route is a route</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   already existing in the AODVv2 router's route table, and is used as</td><td> </td><td class="right">   already existing in the AODVv2 router's route table, and is used as</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   parameter R2 for LoopFree.</td><td> </td><td class="right">   parameter R2 for LoopFree.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">6.5.3.  Default Metric type</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   HopCount is still the default metric for use in MANETs,</td><td> </td><td class="right">   HopCount is still the default metric for use in MANETs,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   notwithstanding the above objections.  <span class="delete">Each metric has to have a</span></td><td> </td><td class="rblock">   notwithstanding the above objections.  <span class="insert">Therefor,</span> the <span class="insert">default</span> Metric</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   Metric Type, and</span> the Metric Type is <span class="delete">allocated by IANA as specified in</span></td><td> </td><td class="rblock">   Type <span class="insert">DEFAULT_METRIC_TYPE</span> is Hop <span class="insert">Count.  It is also the only metric</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   [RFC6551].</span>  Hop <span class="delete">Count has Metric Type assignment 3.  The Cost of a</span></td><td> </td><td class="rblock"><span class="insert">   described in detail by this protocol.  With this metric, Cost(L) is</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   route using Metric Type 3</span> is simply the hop count between the router</td><td> </td><td class="rblock"><span class="insert">   always 1, and Cost(R)</span> is simply the hop count between the router and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   and the destination.  <span class="delete">Using Metric Type 3, LoopFree (AdvRte, Route)</span></td><td> </td><td class="rblock">   the destination.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   is TRUE when Cost(AdvRte) &lt;= Cost(Route).  The specification of</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   Cost(R) and LoopFree(AdvRte, Route) for metric types other than 3 is</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   beyond the scope of this document.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">Whenever an AODV router receives metric information in an incoming</span></td><td> </td><td class="rblock">   <span class="insert">MAX_METRIC[DEFAULT_METRIC_TYPE]</span> is defined to be <span class="insert">MAX_HOPCOUNT.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   message, the value of the metric</span> is <span class="delete">as measured by the transmitting</span></td><td> </td><td class="rblock"><span class="insert">   MAX_HOPCOUNT MUST be larger than</span> the <span class="insert">AODVv2 network diameter.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   router, and does not reflect the cost of traversing the incoming</span></td><td> </td><td class="rblock"><span class="insert">   Otherwise, AODVv2 protocol messages may not reach their intended</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   link.  In order to simplify the description of storing accrued route</span></td><td> </td><td class="rblock"><span class="insert">   destinations.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   costs in the route table, the Cost() function is also</span> defined to</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">return the value of traversing a link 'L'.  In other words, the</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   domain of the Cost() function is enlarged to include links as well as</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   routes.  For Metric Type 3, (i.e., the HopCount metric) Cost(L) = 1</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   for all links L.  The specification of Cost(L) for metric types other</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   than 3 is beyond the scope of this document.  Whether the argument of</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   the Cost() function is a link or a route will, in this document,</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   always</span> be <span class="delete">clear.  As a natural result of the way routes are looked up</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   according to conformant metric type, all intermediate routers</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   handling a RteMsg will assign the same metric type to all metric</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   information in</span> the <span class="delete">RteMsg.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">For some metrics, a maximum value</span> is <span class="delete">defined, namely MAX_METRIC[i]</span></td><td> </td><td class="rblock">   <span class="insert">Using Metric Type DEFAULT_METRIC_TYPE, LoopFree (AdvRte, Route)</span> is</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   where 'i'</span> is the <span class="delete">Metric Type.  AODVv2 does not store</span> routes that <span class="delete">cost</span></td><td> </td><td class="rblock">   <span class="insert">TRUE when Cost(AdvRte) &lt;= Cost(Route) The specification of Cost(R)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   more than MAX_METRIC[i].  MAX_METRIC[3]</span> is <span class="delete">defined</span> to be</td><td> </td><td class="rblock"><span class="insert">   and LoopFree(AdvRte, Route) for metric types other than</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">MAX_HOPCOUNT, where as before 3 is</span> the <span class="delete">Metric Type</span> of the <span class="delete">HopCount</span></td><td> </td><td class="rblock"><span class="insert">   DEFAULT_METRIC_TYPE</span> is <span class="insert">beyond</span> the <span class="insert">scope of this document.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   metric.  MAX_HOPCOUNT MUST be larger than</span> the <span class="delete">AODVv2 network</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">   diameter.  Otherwise, AODVv2 protocol messages may not reach</span> their</td><td> </td><td class="rblock"><span class="insert">6.5.4.  Alternate Metrics</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   <span class="delete">intended destinations.</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Some applications may require metric information other than Hop</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Count, which has traditionally been the default metric associated</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   with</span> routes <span class="insert">in MANET.  It is well known</span> that <span class="insert">reliance on Hop Count</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   can cause selection of the worst possible route in many situations.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   Therefor, it</span> is <span class="insert">important</span> to <span class="insert">enable route selection based on metric</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   information other than Hop Count -- in other words, based on</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   "alternate metrics".</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   The range and data type of each such alternate metric may</span> be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">   <span class="insert">different.  For instance,</span> the <span class="insert">data type might be integers, or</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   floating point numbers, or restricted subsets thereof.  Thus, it is</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   out</span> of the <span class="insert">scope of this document to specify</span> the <span class="insert">Cost(L) and Cost(R)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">   functions or</span> their <span class="insert">return type for alternate metrics.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">6.6.  RREQ Table: Received RREQ Messages</td><td> </td><td class="right">6.6.  RREQ Table: Received RREQ Messages</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Two incoming RREQ messages are considered to be "comparable" if they</td><td> </td><td class="right">   Two incoming RREQ messages are considered to be "comparable" if they</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   were generated by the same AODVv2 router in order to discover a route</td><td> </td><td class="right">   were generated by the same AODVv2 router in order to discover a route</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   for the same destination with the same metric type.  According to</td><td> </td><td class="right">   for the same destination with the same metric type.  According to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   that notion of comparability, when RREQ messages are flooded in a</td><td> </td><td class="right">   that notion of comparability, when RREQ messages are flooded in a</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   MANET, an AODVv2 router may well receive comparable RREQ messages</td><td> </td><td class="right">   MANET, an AODVv2 router may well receive comparable RREQ messages</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   from more than one of its neighbors.  A router, after receiving an</td><td> </td><td class="right">   from more than one of its neighbors.  A router, after receiving an</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   RREQ message, MUST check against previous RREQs to assure that its</td><td> </td><td class="right">   RREQ message, MUST check against previous RREQs to assure that its</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> page 18, line 42</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> page 19, line 9</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      such incoming routing information to update a route table entry is</td><td> </td><td class="right">      such incoming routing information to update a route table entry is</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      not recommended.</td><td> </td><td class="right">      not recommended.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   4.  Offers improvement::</td><td> </td><td class="right">   4.  Offers improvement::</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Advertised routing information that does not match any of the</td><td> </td><td class="right">      Advertised routing information that does not match any of the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      above criteria is better than existing route table information and</td><td> </td><td class="right">      above criteria is better than existing route table information and</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      SHOULD be used to improve the route table.  The following pseudo-</td><td> </td><td class="right">      SHOULD be used to improve the route table.  The following pseudo-</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      code illustrates whether advertised routing information should be</td><td> </td><td class="right">      code illustrates whether advertised routing information should be</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      used to update an existing route table entry as described in</td><td> </td><td class="right">      used to update an existing route table entry as described in</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      Section 7.2.</td><td> </td><td class="right">      Section 7.2.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     (AdvRte.SeqNum &gt; Route.SeqNum) OR</td><td> </td><td class="rblock">   (AdvRte.SeqNum &gt; Route.SeqNum) OR</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         ((AdvRte.SeqNum == Route.SeqNum) AND</td><td> </td><td class="rblock">       ((AdvRte.SeqNum == Route.SeqNum) AND</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                [(AdvRte.Cost &lt; Route.Metric) OR</td><td> </td><td class="right">                [(AdvRte.Cost &lt; Route.Metric) OR</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 ((Route.State == Broken) &amp;&amp; LoopFree (AdvRte, Route))])</td><td> </td><td class="right">                 ((Route.State == Broken) &amp;&amp; LoopFree (AdvRte, Route))])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      The above logic corresponds to placing the following conditions</td><td> </td><td class="right">      The above logic corresponds to placing the following conditions</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      (compared to the existing route table entry) on the advertised</td><td> </td><td class="right">      (compared to the existing route table entry) on the advertised</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      route update before it can be used:</td><td> </td><td class="right">      route update before it can be used:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      *  it is more recent, or</td><td> </td><td class="right">      *  it is more recent, or</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      *  it is not stale and is less costly, or</td><td> </td><td class="right">      *  it is not stale and is less costly, or</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      *  it can safely repair a broken route.</td><td> </td><td class="right">      *  it can safely repair a broken route.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> page 24, line 34</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> page 25, line 4</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       either OrigSeqNum or TargSeqNum.  If the required data elements</td><td> </td><td class="right">       either OrigSeqNum or TargSeqNum.  If the required data elements</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       are absent, the message is disregarded.</td><td> </td><td class="right">       are absent, the message is disregarded.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   3.  The router checks that OrigAddr and TargAddr are routable unicast</td><td> </td><td class="right">   3.  The router checks that OrigAddr and TargAddr are routable unicast</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       addresses.  If not, the message is disregarded.</td><td> </td><td class="right">       addresses.  If not, the message is disregarded.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   4.  If the MetricType is absent, the router uses DEFAULT_METRIC_TYPE</td><td> </td><td class="right">   4.  If the MetricType is absent, the router uses DEFAULT_METRIC_TYPE</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for the metric type.  Otherwise the router verifies that the</td><td> </td><td class="right">       for the metric type.  Otherwise the router verifies that the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       MetricType is known; if not, the message is disregarded.</td><td> </td><td class="right">       MetricType is known; if not, the message is disregarded.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       *  DISCUSSION: or, can change Metric data element to use</td><td> </td><td class="right">       *  DISCUSSION: or, can change Metric data element to use</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">          HopCount, e.g., measured from msg_hop_count.</td><td> </td><td class="right">          HopCount, e.g., measured from msg_hop_count.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">   5.  If (MAX_METRIC[MetricType] - Cost(L)) &lt;= RteMsg_Metric, <span class="delete">the</span></td><td> </td><td class="rblock">                                                                         </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       RteMsg is disregarded,</span> where <span class="delete">Cost(L)</span> denotes the <span class="delete">cost of</span></td><td> </td><td class="rblock">   5.  If (MAX_METRIC[MetricType] - Cost(L)) &lt;= RteMsg_Metric, where <span class="insert">L</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       traversing the</span> incoming <span class="delete">link (i.e., as measured by</span> the <span class="delete">network</span></td><td> </td><td class="rblock">       denotes the incoming <span class="insert">link,</span> the <span class="insert">RteMsg is disregarded.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       interface receiving the incoming RteMsg).</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   An AODVv2 router handles a valid RteMsg as follows:</td><td> </td><td class="right">   An AODVv2 router handles a valid RteMsg as follows:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   1.  The router MUST process the advertised route for OrigAddr or</td><td> </td><td class="right">   1.  The router MUST process the advertised route for OrigAddr or</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       TargAddr contained in the RteMsg as specified in Section 7.1.</td><td> </td><td class="right">       TargAddr contained in the RteMsg as specified in Section 7.1.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   2.  If msg_hop_limit is zero (0), no further action is taken, and the</td><td> </td><td class="right">   2.  If msg_hop_limit is zero (0), no further action is taken, and the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       RteMsg is not regenerated.  Otherwise, the router MUST decrement</td><td> </td><td class="right">       RteMsg is not regenerated.  Otherwise, the router MUST decrement</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       msg_hop_limit.</td><td> </td><td class="right">       msg_hop_limit.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   3.  If the RteMsg.msg_hop_count is present, and MAX_HOPCOUNT &lt;=</td><td> </td><td class="right">   3.  If the RteMsg.msg_hop_count is present, and MAX_HOPCOUNT &lt;=</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       msg_hop_count, then no further action is taken.  Otherwise, the</td><td> </td><td class="right">       msg_hop_count, then no further action is taken.  Otherwise, the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> page 47, line 9</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> page 48, line 9</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      outRERR.PfxLen[] := prefix lengths for unreachable destinations</td><td> </td><td class="right">      outRERR.PfxLen[] := prefix lengths for unreachable destinations</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      outRERR.LostDest[] := unreachable destinations</td><td> </td><td class="right">      outRERR.LostDest[] := unreachable destinations</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      outRERR.LostSeq[] := sequence #s for unreachable destinations</td><td> </td><td class="right">      outRERR.LostSeq[] := sequence #s for unreachable destinations</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.1.  Subroutines for AODVv2 Protocol Operations</td><td> </td><td class="right">A.1.  Subroutines for AODVv2 Protocol Operations</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* Compare incoming route information to current route, maybe use */</td><td> </td><td class="right">    /* Compare incoming route information to current route, maybe use */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    Process_Routing_Info (dest, seq#, metric_type, metric,</td><td> </td><td class="right">    Process_Routing_Info (dest, seq#, metric_type, metric,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                       last_hop_metric)</td><td> </td><td class="right">                                                       last_hop_metric)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">      /* last_hop_metric: either Cost(inRREQ.netif) or (inRREP.netif) */</td><td> </td><td class="right">      /* last_hop_metric: either Cost(inRREQ.netif) or (inRREP.netif) */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    {</td><td> </td><td class="right">    {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    new_metric := metric + last_hop_metric;</td><td> </td><td class="rblock">  new_metric := metric + last_hop_metric;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    rte := Fetch_Route_Table_Entry (dest, seq#, metric_type);</td><td> </td><td class="rblock">  rte := Fetch_Route_Table_Entry (dest, seq#, metric_type);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (NULL == rte) {</td><td> </td><td class="rblock">  if (NULL == rte) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        rte := Create_Route_Table_Entry</td><td> </td><td class="rblock">      rte := Create_Route_Table_Entry</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                (dest, seq#, metric_type, new_metric);</td><td> </td><td class="rblock">        (dest, seq#, metric_type, new_metric);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    } else if (seq# &gt; rte.seq#) { /* stale rte route entry */</td><td> </td><td class="rblock">  } else if (seq# &gt; rte.seq#) { /* stale rte route entry */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        Update_Route_Table_Entry (rte, seq#, metric_type, new_metric);</td><td> </td><td class="rblock">      Update_Route_Table_Entry (rte, seq#, metric_type, new_metric);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    } else if (seq# &lt; rte.seq#) { /* stale incoming route infor */</td><td> </td><td class="rblock">  } else if (seq# &lt; rte.seq#) { /* stale incoming route infor */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return(NULL);</td><td> </td><td class="rblock">      return(NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    } else if (rte.state == broken) {  /* when (seq# == rte.seq#) */</td><td> </td><td class="rblock">  } else if (rte.state == broken) {  /* when (seq# == rte.seq#) */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        Update_Route_Table_Entry (rte, seq#, metric_type, new_metric);</td><td> </td><td class="rblock">      Update_Route_Table_Entry (rte, seq#, metric_type, new_metric);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    } else if (rte.metric &gt; (new_metric) { /* and (seq# == rte.seq#) */</td><td> </td><td class="rblock">  } else if (rte.metric &gt; (new_metric) { /* and (seq# == rte.seq#) */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        Update_Route_Table_Entry (rte, seq#, metric_type, new_metric);</td><td> </td><td class="rblock">      Update_Route_Table_Entry (rte, seq#, metric_type, new_metric);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    } else {    /* incoming route information is not useful */</td><td> </td><td class="rblock">  } else {  /* incoming route information is not useful */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return(NULL);</td><td> </td><td class="rblock">      return(NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return (rte);</td><td> </td><td class="rblock">  return (rte);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.2.  Example Algorithms for AODVv2 RREQ Operations</td><td> </td><td class="right">A.2.  Example Algorithms for AODVv2 RREQ Operations</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.2.1.  Generate_RREQ</td><td> </td><td class="right">A.2.1.  Generate_RREQ</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Generate_RREQ {</td><td> </td><td class="rblock">    <span class="insert">  </span>Generate_RREQ {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* Marshall parameters */</td><td> </td><td class="right">    /* Marshall parameters */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    outRREQ.origIP := IP address used by application</td><td> </td><td class="right">    outRREQ.origIP := IP address used by application</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    outRREQ.origSeq := originating router's sequence #</td><td> </td><td class="right">    outRREQ.origSeq := originating router's sequence #</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    outRREQ.metType := (if included) metric type needed by application</td><td> </td><td class="right">    outRREQ.metType := (if included) metric type needed by application</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    outRREQ.origMet := 0 (default) or MIN_METRIC(Metric_type)</td><td> </td><td class="right">    outRREQ.origMet := 0 (default) or MIN_METRIC(Metric_type)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    outRREQ.targIP := target IP address</td><td> </td><td class="right">    outRREQ.targIP := target IP address</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    outRREQ.targSeq := target sequence # /* if known from route table */</td><td> </td><td class="right">    outRREQ.targSeq := target sequence # /* if known from route table */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    outRREQ.hopLim := msg-hop-limit   <span class="delete">  </span>/* RFC 5444 */</td><td> </td><td class="rblock">    outRREQ.hopLim := msg-hop-limit   /* RFC 5444 */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* build RFC 5444 message header fields */</td><td> </td><td class="right">    /* build RFC 5444 message header fields */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    {</td><td> </td><td class="right">    {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        msg-type=RREQ (message is of type RREQ)</td><td> </td><td class="rblock">      msg-type=RREQ (message is of type RREQ)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td> </td><td class="rblock">      MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td> </td><td class="rblock">      MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td> </td><td class="rblock">      msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        msg-hop-limit := MAX_HOPCOUNT</td><td> </td><td class="rblock">      msg-hop-limit := MAX_HOPCOUNT</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if (Metric_type == DEFAULT) {</td><td> </td><td class="rblock">      if (Metric_type == DEFAULT) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            msg.tlvs-length=0</td><td> </td><td class="rblock">        msg.tlvs-length=0</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        } else { /* Metric_type != HopCount */</td><td> </td><td class="rblock">      } else { /* Metric_type != HopCount */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            /* Build Metric_type Message TLV */</td><td> </td><td class="rblock">        /* Build Metric_type Message TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        }</td><td> </td><td class="rblock">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* build AddrBlk */</td><td> </td><td class="right">    /* build AddrBlk */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    num-addr := 2</td><td> </td><td class="right">    num-addr := 2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    AddrBlk := {outRREQ.origIP and outRREQ.targIP addresses}</td><td> </td><td class="right">    AddrBlk := {outRREQ.origIP and outRREQ.targIP addresses}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* Include each available Sequence Number in appropriate AddrTLV */</td><td> </td><td class="right">    /* Include each available Sequence Number in appropriate AddrTLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        /* put outRREQ.origSeq in OrigSeqNum AddrTLV */</td><td> </td><td class="rblock">      /* put outRREQ.origSeq in OrigSeqNum AddrTLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if (NULL != targSeq) {</td><td> </td><td class="rblock">      if (NULL != targSeq) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            /* put outRREQ.targSeq in TargSeqNum AddrTLV */</td><td> </td><td class="rblock">        /* put outRREQ.targSeq in TargSeqNum AddrTLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        }</td><td> </td><td class="rblock">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* Build Metric AddrTLV containing OrigAddr metric */</td><td> </td><td class="right">    /* Build Metric AddrTLV containing OrigAddr metric */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        /* use MIN_METRIC(metric type) [==0 for default metric type */</td><td> </td><td class="rblock">      /* use MIN_METRIC(metric type) [==0 for default metric type */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">      }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.2.2.  Receive_RREQ</td><td> </td><td class="right">A.2.2.  Receive_RREQ</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     Receive_RREQ (inRREQ) {</td><td> </td><td class="rblock">     <span class="insert">  </span>Receive_RREQ (inRREQ) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     /* Extract inRREQ values */</td><td> </td><td class="right">     /* Extract inRREQ values */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     origRTE = Process_Routing_Info (inRREQ.origIP, inRREQ.origSeq, ...)</td><td> </td><td class="right">     origRTE = Process_Routing_Info (inRREQ.origIP, inRREQ.origSeq, ...)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     if (inRREQ.targIP belongs to me or my client subnet) {</td><td> </td><td class="right">     if (inRREQ.targIP belongs to me or my client subnet) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">  </span>Generate_RREP()</td><td> </td><td class="rblock">       Generate_RREP()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     } else if (inRREQ present in RREQ_table) {</td><td> </td><td class="right">     } else if (inRREQ present in RREQ_table) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">  return;  </span>   /* don't regenerate RREQ... */</td><td> </td><td class="rblock">       <span class="insert">return;</span>   /* don't regenerate RREQ... */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     } else if (inRREQ.nbrIP not present in blacklist) {</td><td> </td><td class="right">     } else if (inRREQ.nbrIP not present in blacklist) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">  </span>Regenerate_RREQ(origRTE, inRREQ)</td><td> </td><td class="rblock">       Regenerate_RREQ(origRTE, inRREQ)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     } else if (blacklist_expiration_time &gt; current_time) {</td><td> </td><td class="right">     } else if (blacklist_expiration_time &gt; current_time) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">  return;  </span>   /* don't regenerate RREQ... */</td><td> </td><td class="rblock">       <span class="insert">return;</span>   /* don't regenerate RREQ... */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     } else {</td><td> </td><td class="right">     } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         Remove nbrIP from blacklist;</td><td> </td><td class="rblock">       Remove nbrIP from blacklist;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         Regenerate_RREQ(origRTE, inRREQ)</td><td> </td><td class="rblock">       Regenerate_RREQ(origRTE, inRREQ)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     <span class="delete">}</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     }</td><td> </td><td class="right">     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.2.3.  Regenerate_RREQ</td><td> </td><td class="right">A.2.3.  Regenerate_RREQ</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    Regenerate_RREQ (origRTE, inRREQ) { /* called from receive_RREQ() */</td><td> </td><td class="right">    Regenerate_RREQ (origRTE, inRREQ) { /* called from receive_RREQ() */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    outRREQ.hopLim := inRREQ.hopLim - 1</td><td> </td><td class="rblock">  outRREQ.hopLim := inRREQ.hopLim - 1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (outRREQ.hopLim == 0) {  /* don't regenerate */</td><td> </td><td class="rblock">  if (outRREQ.hopLim == 0) {  /* don't regenerate */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return()</td><td> </td><td class="rblock">    return()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    /* Marshall parameters */</td><td> </td><td class="rblock">  /* Marshall parameters */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    outRREQ.origIP := origRTE.origIP</td><td> </td><td class="rblock">  outRREQ.origIP := origRTE.origIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    outRREQ.origSeq := origRTE.origSeq</td><td> </td><td class="rblock">  outRREQ.origSeq := origRTE.origSeq</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    outRREQ.origMet := origRTE.origMet</td><td> </td><td class="rblock">  outRREQ.origMet := origRTE.origMet</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    outRREQ.metType := origRTE.metType</td><td> </td><td class="rblock">  outRREQ.metType := origRTE.metType</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    outRREQ.targIP := inRREQ.targIP</td><td> </td><td class="rblock">  outRREQ.targIP := inRREQ.targIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    outRREQ.targSeq := inRREQ.targSeq   /* if present */</td><td> </td><td class="rblock">  outRREQ.targSeq := inRREQ.targSeq /* if present */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    /* build RFC 5444 message header fields */</td><td> </td><td class="rblock">  /* build RFC 5444 message header fields */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">  {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        msg-type=RREQ (message is of type RREQ)</td><td> </td><td class="rblock">    msg-type=RREQ (message is of type RREQ)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td> </td><td class="rblock">    MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td> </td><td class="rblock">    MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td> </td><td class="rblock">    msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        msg-hop-limit := MAX_METRIC(Metric Type) (default, MAX_HOPCOUNT)</td><td> </td><td class="rblock">    msg-hop-limit := MAX_METRIC(Metric Type) (default, MAX_HOPCOUNT)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if (Metric_type == DEFAULT) {</td><td> </td><td class="rblock">    if (Metric_type == DEFAULT) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            msg.tlvs-length=0</td><td> </td><td class="rblock">      msg.tlvs-length=0</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        } else { /* Metric_type != HopCount */</td><td> </td><td class="rblock">    } else { /* Metric_type != HopCount */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            /* Build Metric_type Message TLV */</td><td> </td><td class="rblock">      /* Build Metric_type Message TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        <span class="delete">}</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">  }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    /* build AddrBlk */</td><td> </td><td class="rblock">  /* build AddrBlk */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    num-addr := 2</td><td> </td><td class="rblock">  num-addr := 2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    AddrBlk := {outRREQ.origIP and outRREQ.targIP addresses}</td><td> </td><td class="rblock">  AddrBlk := {outRREQ.origIP and outRREQ.targIP addresses}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    /* Include each available Sequence Number in its proper AddrTLV */</td><td> </td><td class="rblock">  /* Include each available Sequence Number in its proper AddrTLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    /* put outRREQ.origSeq in OrigSeqNum AddrTLV */</td><td> </td><td class="rblock">  /* put outRREQ.origSeq in OrigSeqNum AddrTLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (NULL != targSeq) {</td><td> </td><td class="rblock">  if (NULL != targSeq) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        /* put outRREQ.targSeq in TargSeqNum AddrTLV */</td><td> </td><td class="rblock">    /* put outRREQ.targSeq in TargSeqNum AddrTLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">  <span class="delete">  </span>/* Build Metric AddrTLV to contain outRREQ.origMet */</td><td> </td><td class="rblock">  /* Build Metric AddrTLV to contain outRREQ.origMet */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.3.  Example Algorithms for AODVv2 RREP Operations</td><td> </td><td class="right">A.3.  Example Algorithms for AODVv2 RREP Operations</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.3.1.  Generate_RREP</td><td> </td><td class="right">A.3.1.  Generate_RREP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     Generate_RREP {</td><td> </td><td class="rblock">     <span class="insert">  </span>Generate_RREP {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     /* Marshall parameters */</td><td> </td><td class="right">     /* Marshall parameters */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     outRREP.origIP := origRTE.origIP</td><td> </td><td class="right">     outRREP.origIP := origRTE.origIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     metric_type := origRTE.metType  /* if not default */</td><td> </td><td class="right">     metric_type := origRTE.metType  /* if not default */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     if (DEFAULT != metric_type)</td><td> </td><td class="right">     if (DEFAULT != metric_type)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0046" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">  </span>outRREP.metType := metric_type</td><td> </td><td class="rblock">       outRREP.metType := metric_type</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     outRREP.targIP := inRREQ.targIP</td><td> </td><td class="right">     outRREP.targIP := inRREQ.targIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     outRREP.targMet := MIN_METRIC(outRREP.metType) (0  by default)</td><td> </td><td class="right">     outRREP.targMet := MIN_METRIC(outRREP.metType) (0  by default)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     my_sequence_# := (1 + my_sequence_#) /* from nonvolatile storage */</td><td> </td><td class="right">     my_sequence_# := (1 + my_sequence_#) /* from nonvolatile storage */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     outRREP.targSeq := my_sequence_#</td><td> </td><td class="right">     outRREP.targSeq := my_sequence_#</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     /* build RFC 5444 message header fields */</td><td> </td><td class="right">     /* build RFC 5444 message header fields */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     {</td><td> </td><td class="right">     {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0047" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         msg-type=RREP</td><td> </td><td class="rblock">       msg-type=RREP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td> </td><td class="rblock">       MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td> </td><td class="rblock">       MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td> </td><td class="rblock">       msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         msg-hop-limit := MAX_HOPCOUNT</td><td> </td><td class="rblock">       msg-hop-limit := MAX_HOPCOUNT</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         /* Include the AckReq TLV when:</td><td> </td><td class="rblock">       /* Include the AckReq TLV when:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            - previous RREP does not seem to enable any data flow, OR</td><td> </td><td class="rblock">          - previous RREP does not seem to enable any data flow, OR</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            - when RREQ is received from same OrigAddr after RREP was</td><td> </td><td class="rblock">          - when RREQ is received from same OrigAddr after RREP was</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              unicast to targRTE.nextHop</td><td> </td><td class="rblock">            unicast to targRTE.nextHop</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          */</td><td> </td><td class="rblock">        */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         if (DEFAULT != metric_type) {</td><td> </td><td class="rblock">       if (DEFAULT != metric_type) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">             msg.tlvs-length=0</td><td> </td><td class="rblock">         msg.tlvs-length=0</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         } else { /* Metric_type != HopCount */</td><td> </td><td class="rblock">       } else { /* Metric_type != HopCount */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">             /* Build Metric_type Message TLV */</td><td> </td><td class="rblock">         /* Build Metric_type Message TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     }</td><td> </td><td class="right">     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     /* build AddrBlk */</td><td> </td><td class="right">     /* build AddrBlk */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     num-addr := 2</td><td> </td><td class="right">     num-addr := 2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     AddrBlk := {outRREQ.origIP and outRREQ.targIP addresses}</td><td> </td><td class="right">     AddrBlk := {outRREQ.origIP and outRREQ.targIP addresses}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     /* put outRREP.TargSeq in TargSeqNum AddrTLV */</td><td> </td><td class="right">     /* put outRREP.TargSeq in TargSeqNum AddrTLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     /* Build Metric AddrTLV containing TargAddr metric */</td><td> </td><td class="right">     /* Build Metric AddrTLV containing TargAddr metric */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">     /* use MIN_METRIC(origRTE.metType) */</td><td> </td><td class="right">     /* use MIN_METRIC(origRTE.metType) */</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0048" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     }</td><td> </td><td class="rblock">     <span class="insert">  </span>}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.3.2.  Receive_RREP</td><td> </td><td class="right">A.3.2.  Receive_RREP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0049" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Receive_RREP (inRREP)</td><td> </td><td class="rblock">      Receive_RREP (inRREP)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">      {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    If (RREP includes AckReq data element) {</td><td> </td><td class="right">    If (RREP includes AckReq data element) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0050" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">  </span>Generate_RREP_Ack()</td><td> </td><td class="rblock">      Generate_RREP_Ack()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    /* Extract inRREP values */</td><td> </td><td class="right">    /* Extract inRREP values */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    targRTE := Process_Routing_Info (inRREP.targIP, inRREP.targSeq, ...)</td><td> </td><td class="right">    targRTE := Process_Routing_Info (inRREP.targIP, inRREP.targSeq, ...)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (inRREP.targIP belongs to me, a client, or a client subnet) {</td><td> </td><td class="right">    if (inRREP.targIP belongs to me, a client, or a client subnet) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0051" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      <span class="delete">  </span>Consume_RREP(inRREP)</td><td> </td><td class="rblock">      Consume_RREP(inRREP)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    } else {</td><td> </td><td class="right">    } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0052" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        Regenerate_RREP(targRTE, inRREP)</td><td> </td><td class="rblock">      Regenerate_RREP(targRTE, inRREP)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">}</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    }</td><td> </td><td class="right">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0053" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">      }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.3.3.  Regenerate_RREP</td><td> </td><td class="right">A.3.3.  Regenerate_RREP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0054" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      Regenerate_RREP(targRTE, inRREP) {</td><td> </td><td class="rblock">       Regenerate_RREP(targRTE, inRREP) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      outRREP.hopLim := inRREP.hopLim - 1</td><td> </td><td class="rblock">     outRREP.hopLim := inRREP.hopLim - 1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      if (outRREP.hopLim == 0) {  /* don't regenerate */</td><td> </td><td class="rblock">     if (outRREP.hopLim == 0) {  /* don't regenerate */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          return()</td><td> </td><td class="rblock">       return()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }</td><td> </td><td class="rblock">     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* Marshall parameters */</td><td> </td><td class="rblock">     /* Marshall parameters */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      outRREP.targIP := targRTE.targIP</td><td> </td><td class="rblock">     outRREP.targIP := targRTE.targIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      outRREP.targSeq := targRTE.targSeq</td><td> </td><td class="rblock">     outRREP.targSeq := targRTE.targSeq</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      outRREP.targMet := targRTE.targMet</td><td> </td><td class="rblock">     outRREP.targMet := targRTE.targMet</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      metric_type := origRTE.metType  /* if not default */</td><td> </td><td class="rblock">     metric_type := origRTE.metType  /* if not default */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      if (DEFAULT != metric_type)</td><td> </td><td class="rblock">     if (DEFAULT != metric_type)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          outRREP.metType := metric_type</td><td> </td><td class="rblock">       outRREP.metType := metric_type</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      outRREP.origIP := inRREP.origIP</td><td> </td><td class="rblock">     outRREP.origIP := inRREP.origIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      outRREP.nextHop := targRTE.nextHop</td><td> </td><td class="rblock">     outRREP.nextHop := targRTE.nextHop</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0055" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* build RFC 5444 message header fields */</td><td> </td><td class="rblock">     /* build RFC 5444 message header fields */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      {</td><td> </td><td class="rblock">     {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          msg-type=RREP (message is of type RREP)</td><td> </td><td class="rblock">       msg-type=RREP (message is of type RREP)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td> </td><td class="rblock">       MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td> </td><td class="rblock">       MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td> </td><td class="rblock">       msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          /* Include the AckReq data element when:</td><td> </td><td class="rblock">       /* Include the AckReq data element when:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">             - previous RREP does not seem to enable any data flow, OR</td><td> </td><td class="rblock">          - previous RREP does not seem to enable any data flow, OR</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">             - when RREQ is received from same OrigAddr after RREP was</td><td> </td><td class="rblock">          - when RREQ is received from same OrigAddr after RREP was</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               unicast to targRTE.nextHop</td><td> </td><td class="rblock">            unicast to targRTE.nextHop</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           */</td><td> </td><td class="rblock">        */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          msg-hop-limit := outRREP.hopLim;</td><td> </td><td class="rblock">       msg-hop-limit := outRREP.hopLim;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          if (metric_type == DEFAULT) {</td><td> </td><td class="rblock">       if (metric_type == DEFAULT) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              msg.tlvs-length=0</td><td> </td><td class="rblock">         msg.tlvs-length=0</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          } else { /* Metric_type != HopCount */</td><td> </td><td class="rblock">       } else { /* Metric_type != HopCount */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              /* Build Metric_type Message TLV */</td><td> </td><td class="rblock">         /* Build Metric_type Message TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }</td><td> </td><td class="rblock">     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0056" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* build AddrBlk */</td><td> </td><td class="rblock">     /* build AddrBlk */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      num-addr := 2</td><td> </td><td class="rblock">     num-addr := 2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      AddrBlk := {outRREQ.origIP and outRREQ.targIP addresses}</td><td> </td><td class="rblock">     AddrBlk := {outRREQ.origIP and outRREQ.targIP addresses}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0057" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     <span class="delete"> </span>/* put outRREP.targSeq in TargSeqNum AddrTLV */</td><td> </td><td class="rblock">     /* put outRREP.targSeq in TargSeqNum AddrTLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0058" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* Build Metric AddrTLV containing TargAddr metric */</td><td> </td><td class="rblock">     /* Build Metric AddrTLV containing TargAddr metric */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.3.4.  Consume_RREP</td><td> </td><td class="right">A.3.4.  Consume_RREP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0059" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       /* executed by RREQ_Gen */</td><td> </td><td class="rblock">     /* executed by RREQ_Gen */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       /* TargAddr route table entry was updated by Receive_RREP() */</td><td> </td><td class="rblock">     /* TargAddr route table entry was updated by Receive_RREP() */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       Consume_RREP() {</td><td> </td><td class="rblock">     Consume_RREP() {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           /* Transmit buffered packet(s) (if any) to TargAddr */</td><td> </td><td class="rblock">       /* Transmit buffered packet(s) (if any) to TargAddr */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       }</td><td> </td><td class="rblock">     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.4.  Example Algorithms for AODVv2 RERR Operations</td><td> </td><td class="right">A.4.  Example Algorithms for AODVv2 RERR Operations</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.4.1.  Generate_RERR</td><td> </td><td class="right">A.4.1.  Generate_RERR</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0060" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      Generate_RERR()</td><td> </td><td class="rblock">       Generate_RERR()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      {</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      metric_type := DEFAULT;</td><td> </td><td class="rblock">     metric_type := DEFAULT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      switch (error_type) in {</td><td> </td><td class="rblock">     switch (error_type) in {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      case (broken_link):</td><td> </td><td class="rblock">     case (broken_link):</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          num-broken-addr=0</td><td> </td><td class="rblock">       num-broken-addr=0</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          /* find unreachable destinations, seqNums, prefixes */</td><td> </td><td class="rblock">       /* find unreachable destinations, seqNums, prefixes */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          for (every rte (route table entry) in route table) {</td><td> </td><td class="rblock">       for (every rte (route table entry) in route table) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              if (broken_link == rte.next_hop) {</td><td> </td><td class="rblock">           if (broken_link == rte.next_hop) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              rte.state := broken;</td><td> </td><td class="rblock">         rte.state := broken;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              outRERR.LostDest[num-broken-addr] := rte.dest</td><td> </td><td class="rblock">         outRERR.LostDest[num-broken-addr] := rte.dest</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              outRERR.LostSeq[num-broken-addr] := rte.seq#</td><td> </td><td class="rblock">         outRERR.LostSeq[num-broken-addr] := rte.seq#</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              outRERR.PfxLen[num-broken-addr] := rte.pfx</td><td> </td><td class="rblock">         outRERR.PfxLen[num-broken-addr] := rte.pfx</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              metric_type := rte.metType</td><td> </td><td class="rblock">         metric_type := rte.metType</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              num-broken-addr := (num-broken-addr+1)</td><td> </td><td class="rblock">         num-broken-addr := (num-broken-addr+1)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              }</td><td> </td><td class="rblock">           }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          /* No offending-src for this case */</td><td> </td><td class="rblock">       /* No offending-src for this case */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      case (undeliverable packet):</td><td> </td><td class="rblock">     case (undeliverable packet):</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          offending-src := undeliverable_packet.srcIP</td><td> </td><td class="rblock">       offending-src := undeliverable_packet.srcIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          outRERR.LostDest[] := undeliverable_packet.destIP</td><td> </td><td class="rblock">       outRERR.LostDest[] := undeliverable_packet.destIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          outRERR.LostPfxSiz[] := MAX_PFX_SIZE   /* 31 or 127 */</td><td> </td><td class="rblock">       outRERR.LostPfxSiz[] := MAX_PFX_SIZE   /* 31 or 127 */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          num-broken-addr=1</td><td> </td><td class="rblock">       num-broken-addr=1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }</td><td> </td><td class="rblock">     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0061" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* build RFC 5444 message header fields */</td><td> </td><td class="rblock">     /* build RFC 5444 message header fields */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      {</td><td> </td><td class="rblock">     {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          msg-type=RERR (message is of type RERR)</td><td> </td><td class="rblock">       msg-type=RERR (message is of type RERR)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td> </td><td class="rblock">       MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td> </td><td class="rblock">       MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td> </td><td class="rblock">       msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          msg-hop-limit := outRERR.hopLim;</td><td> </td><td class="rblock">       msg-hop-limit := outRERR.hopLim;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          if (NULL != offending-src) {</td><td> </td><td class="rblock">       if (NULL != offending-src) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              /* Build PktSource Message TLV */</td><td> </td><td class="rblock">         /* Build PktSource Message TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          if (metric_type != DEFAULT) { /* Metric_type != HopCount */</td><td> </td><td class="rblock">       if (metric_type != DEFAULT) { /* Metric_type != HopCount */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              /* Build Metric_type Message TLV */</td><td> </td><td class="rblock">         /* Build Metric_type Message TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }</td><td> </td><td class="rblock">     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0062" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* build AddrBlk */</td><td> </td><td class="rblock">     /* build AddrBlk */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      num-addr := num-broken-addr;</td><td> </td><td class="rblock">     num-addr := num-broken-addr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      AddrBlk := outRERR.LostDest[];</td><td> </td><td class="rblock">     AddrBlk := outRERR.LostDest[];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0063" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* Add AddrBlk Seq# TLV */</td><td> </td><td class="rblock">     /* Add AddrBlk Seq# TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      Seq#TLV := outRERR.LostSeq[]</td><td> </td><td class="rblock">     Seq#TLV := outRERR.LostSeq[]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0064" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* only add AddrBlk PfxSiz TLV if prefixes are nondefault */</td><td> </td><td class="rblock">     /* only add AddrBlk PfxSiz TLV if prefixes are nondefault */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      for (pfx in outRERR.LostPfx[]) {</td><td> </td><td class="rblock">     for (pfx in outRERR.LostPfx[]) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          if (pfx != Max_Prefix_Size) { /* 31 for IPv4, 127 for IPv6 */</td><td> </td><td class="rblock">       if (pfx != Max_Prefix_Size) { /* 31 for IPv4, 127 for IPv6 */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              PfxSizTLV := outRERR.LostPfx[]</td><td> </td><td class="rblock">         PfxSizTLV := outRERR.LostPfx[]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              return;</td><td> </td><td class="rblock">         return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }</td><td> </td><td class="rblock">     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.4.2.  Receive_RERR</td><td> </td><td class="right">A.4.2.  Receive_RERR</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Receive_RERR (inERR)</td><td> </td><td class="right">       Receive_RERR (inERR)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0065" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       /* Extract inERR values */</td><td> </td><td class="rblock">     /* Extract inERR values */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       next_hop := inRERR.nbrIP</td><td> </td><td class="rblock">     next_hop := inRERR.nbrIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       offending-src := inRERR.offending-src;  /* NULL if not present */</td><td> </td><td class="rblock">     offending-src := inRERR.offending-src;  /* NULL if not present */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0066" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       precursors[] := NULL;</td><td> </td><td class="rblock">     precursors[] := NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       num-broken-addr := 0;</td><td> </td><td class="rblock">     num-broken-addr := 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       in-broken-addr := 0;</td><td> </td><td class="rblock">     in-broken-addr := 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       for (IPaddr := inRERR.LostDest[in-broken-addr]) {</td><td> </td><td class="rblock">     for (IPaddr := inRERR.LostDest[in-broken-addr]) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           rte := Fetch_Route_Table_Entry (dest, metric_type);</td><td> </td><td class="rblock">       rte := Fetch_Route_Table_Entry (dest, metric_type);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           if (NULL == rte) {</td><td> </td><td class="rblock">       if (NULL == rte) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               continue;</td><td> </td><td class="rblock">         continue;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           } else if (rte.nextHop != inRERR.fromIP) {</td><td> </td><td class="rblock">       } else if (rte.nextHop != inRERR.fromIP) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               continue;</td><td> </td><td class="rblock">         continue;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           } else if (NULL != rte.precursors) {</td><td> </td><td class="rblock">       } else if (NULL != rte.precursors) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               /* add rte.precursors to precursors */</td><td> </td><td class="rblock">         /* add rte.precursors to precursors */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           } else if (rte.PfxSiz &lt; inRERR.PfxSiz) {</td><td> </td><td class="rblock">       } else if (rte.PfxSiz &lt; inRERR.PfxSiz) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           /***********************************************************</td><td> </td><td class="rblock">       /***********************************************************</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            If the reported prefix from the incoming RERR is *longer*</td><td> </td><td class="rblock">        If the reported prefix from the incoming RERR is *longer*</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              than the prefix from Route Table, then create a new route</td><td> </td><td class="rblock">          than the prefix from Route Table, then create a new route</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              with the longer prefix.</td><td> </td><td class="rblock">          with the longer prefix.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              The newly created route will be marked as broken, and used</td><td> </td><td class="rblock">          The newly created route will be marked as broken, and used</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              to regenerate RERR, NOT using shorter the routing prefix.</td><td> </td><td class="rblock">          to regenerate RERR, NOT using shorter the routing prefix.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            This avoids unnecessarily invalidating the larger subnet.</td><td> </td><td class="rblock">          This avoids unnecessarily invalidating the larger subnet.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            **********************************************************/</td><td> </td><td class="rblock">        **********************************************************/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               rte := Create_Route_Table_Entry (IPaddr, seq#,</td><td> </td><td class="rblock">         rte := Create_Route_Table_Entry (IPaddr, seq#,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   metric_type, new_metric, inRERR.PfxSiz);</td><td> </td><td class="rblock">           metric_type, new_metric, inRERR.PfxSiz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           <span class="delete">}</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           LostDest[num-broken-addr] := rte.Dest;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           Seq#[num-broken-addr] := rte.Seq#;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           PfxSiz[num-broken-addr] := rte.PfxSiz;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           rte.state = broken;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           num-broken-addr := (num-broken-addr + 1);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           in-broken-addr := (in-broken-addr + 1);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       if (num-broken-addr &gt; 0) {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           Regenerate_RERR (offending-src, precursors,</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               LostDest[], Seq#[], PfxSiz[])</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0067" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">LostDest[num-broken-addr] := rte.Dest;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Seq#[num-broken-addr] := rte.Seq#;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       PfxSiz[num-broken-addr] := rte.PfxSiz;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       rte.state = broken;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       num-broken-addr := (num-broken-addr + 1);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       in-broken-addr := (in-broken-addr + 1);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     if (num-broken-addr &gt; 0) {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Regenerate_RERR (offending-src, precursors,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">         LostDest[], Seq#[], PfxSiz[])</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">     }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.4.3.  Regenerate_RERR</td><td> </td><td class="right">A.4.3.  Regenerate_RERR</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0068" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      Regenerate_RERR (offending-src, precursors,</td><td> </td><td class="rblock">       Regenerate_RERR (offending-src, precursors,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          LostDest[], LostSeq#[], PfxSiz[])</td><td> </td><td class="rblock">       LostDest[], LostSeq#[], PfxSiz[])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      {</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* build RFC 5444 message header fields */</td><td> </td><td class="rblock">     /* build RFC 5444 message header fields */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      {</td><td> </td><td class="rblock">     {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          msg-type=RERR (message is of type RERR)</td><td> </td><td class="rblock">         msg-type=RERR (message is of type RERR)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td> </td><td class="rblock">         MF=4 (Message Flags = 4 [only msg-hop-limit field is present])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td> </td><td class="rblock">         MAL=3 or 15 (Message Address Length [3 for IPv4, 15 for IPv6])</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td> </td><td class="rblock">         msg-size=NN (octets -- counting MsgHdr, AddrBlk, and AddrTLVs)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          outRERR.hopLim := inRERR.hopLim - 1</td><td> </td><td class="rblock">         outRERR.hopLim := inRERR.hopLim - 1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          msg-hop-limit := outRERR.hopLim;</td><td> </td><td class="rblock">         msg-hop-limit := outRERR.hopLim;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0069" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          if (NULL != offending-src) {</td><td> </td><td class="rblock">         if (NULL != offending-src) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              /* Build PktSource Message TLV */</td><td> </td><td class="rblock">         /* Build PktSource Message TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          }</td><td> </td><td class="rblock">         }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          if (metric_type != DEFAULT) { /* Metric_type != HopCount */</td><td> </td><td class="rblock">         if (metric_type != DEFAULT) { /* Metric_type != HopCount */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              /* Build Metric_type Message TLV */</td><td> </td><td class="rblock">         /* Build Metric_type Message TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          }</td><td> </td><td class="rblock">         }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }</td><td> </td><td class="rblock">     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0070" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* build AddrBlk */</td><td> </td><td class="rblock">     /* build AddrBlk */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      num-addr := num-broken-addr;</td><td> </td><td class="rblock">     num-addr := num-broken-addr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      AddrBlk := LostDest[];</td><td> </td><td class="rblock">     AddrBlk := LostDest[];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0071" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* Add AddrBlk Seq# TLV */</td><td> </td><td class="rblock">     /* Add AddrBlk Seq# TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      Seq#TLV := LostSeq[]</td><td> </td><td class="rblock">     Seq#TLV := LostSeq[]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0072" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      /* only add AddrBlk PfxSiz TLV if prefixes are nondefault */</td><td> </td><td class="rblock">     /* only add AddrBlk PfxSiz TLV if prefixes are nondefault */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      for (pfx in PfxSiz[]) {</td><td> </td><td class="rblock">     for (pfx in PfxSiz[]) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          if (pfx != Max_Prefix_Size) { /* 31 for IPv4, 127 for IPv6 */</td><td> </td><td class="rblock">       if (pfx != Max_Prefix_Size) { /* 31 for IPv4, 127 for IPv6 */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              PfxSizTLV := PfxSiz[]</td><td> </td><td class="rblock">         PfxSizTLV := PfxSiz[]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }   /* If all are default, don't include PfxSize AddrTLV */</td><td> </td><td class="rblock">     } /* If all are default, don't include PfxSize AddrTLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0073" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      if (#precursors == 1) {</td><td> </td><td class="rblock">     if (#precursors == 1) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          unicast RERR to precursor[0];</td><td> </td><td class="rblock">       unicast RERR to precursor[0];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      } else if (#precursors &gt; 1) {</td><td> </td><td class="rblock">     } else if (#precursors &gt; 1) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          multicast RERR to RERR_PRECURSORS;</td><td> </td><td class="rblock">       multicast RERR to RERR_PRECURSORS;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      } else if (offending-src != NULL) {</td><td> </td><td class="rblock">     } else if (offending-src != NULL) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          unicast RERR to offending-src;</td><td> </td><td class="rblock">       unicast RERR to offending-src;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      } else {</td><td> </td><td class="rblock">     } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          multicast RERR to RERR_PRECURSORS;</td><td> </td><td class="rblock">       multicast RERR to RERR_PRECURSORS;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }</td><td> </td><td class="rblock">     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.5.  Example Algorithms for AODVv2 RREP-Ack Operations</td><td> </td><td class="right">A.5.  Example Algorithms for AODVv2 RREP-Ack Operations</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.5.1.  Generate_RREP_Ack</td><td> </td><td class="right">A.5.1.  Generate_RREP_Ack</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       /* To be sent when RREP includes the AckReq TLV */</td><td> </td><td class="right">       /* To be sent when RREP includes the AckReq TLV */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Generate_RREP_Ack()</td><td> </td><td class="right">       Generate_RREP_Ack()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0074" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       /* assign RFC 5444 fields */</td><td> </td><td class="rblock">     /* assign RFC 5444 fields */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       msgtype := RREPAck</td><td> </td><td class="rblock">     msgtype := RREPAck</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       MF := 0</td><td> </td><td class="rblock">     MF := 0</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       MAL := 3</td><td> </td><td class="rblock">     MAL := 3</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       msg-size := 4</td><td> </td><td class="rblock">     msg-size := 4</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.5.2.  Consume_RREP_Ack</td><td> </td><td class="right">A.5.2.  Consume_RREP_Ack</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Consume_RREP_Ack()</td><td> </td><td class="right">       Consume_RREP_Ack()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0075" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     <span class="delete">  </span>/* turn off timeout event for the node sending RREP_Ack */</td><td> </td><td class="rblock">     /* turn off timeout event for the node sending RREP_Ack */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">A.5.3.  Timeout_RREP_Ack</td><td> </td><td class="right">A.5.3.  Timeout_RREP_Ack</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Timeout_RREP_Ack()</td><td> </td><td class="right">       Timeout_RREP_Ack()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0076" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     <span class="delete">  </span>/* insert unresponsive node into blacklist */</td><td> </td><td class="rblock">     /* insert unresponsive node into blacklist */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Appendix B.  Example RFC 5444-compliant packet formats</td><td> </td><td class="right">Appendix B.  Example RFC 5444-compliant packet formats</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   The following subsections show example RFC 5444-compliant packets for</td><td> </td><td class="right">   The following subsections show example RFC 5444-compliant packets for</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   AODVv2 message types RREQ, RREP, RERR, and RREP-Ack.  These proposed</td><td> </td><td class="right">   AODVv2 message types RREQ, RREP, RERR, and RREP-Ack.  These proposed</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   message formats are designed based on expected savings from IPv6</td><td> </td><td class="right">   message formats are designed based on expected savings from IPv6</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   addressable MANET nodes, and a layout for the Address TLVs that may</td><td> </td><td class="right">   addressable MANET nodes, and a layout for the Address TLVs that may</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   be viewed as natural, even if perhaps not the absolute most compact</td><td> </td><td class="right">   be viewed as natural, even if perhaps not the absolute most compact</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   possible encoding.</td><td> </td><td class="right">   possible encoding.</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 76 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>392 lines changed or deleted</i></th><th><i> </i></th><th><i>405 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
